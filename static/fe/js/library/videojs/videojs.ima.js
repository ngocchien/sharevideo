(function(c){if("function"===typeof define&&define.amd)define(["video.js","videojs-contrib-ads"],function(b){c(window,document,b)});else if("object"===typeof exports&&"object"===typeof module){var b=require("video.js");require("videojs-contrib-ads");c(window,document,b)}else c(window,document,videojs)})(function(c,b,k){var o=function(b){var c,i,e;for(i=1;i<arguments.length;i++)for(e in c=arguments[i],c)c.hasOwnProperty(e)&&(b[e]=c[e]);return b},B={debug:!1,timeout:5E3,prerollTimeout:100,adLabel:"Advertisement",
showControlsForJSAds:!0},n=function(h,j,i){this.player=h;var e=function(a,d){a.id=this.controlPrefix+d;a.className=this.controlPrefix+d+" "+d}.bind(this),p=function(a){return RegExp("(^|[^A-Za-z-])"+a+"((?![A-Za-z-])|$)","gi")},f=function(a,d){return p(d).test(a.className)?a:a.className=a.className.trim()+" "+d},g=function(a,d){var b=p(d);return!b.test(a.className)?a:a.className=a.className.trim().replace(b,"")},k=function(){this.vjsControls=this.player.getChild("controlBar");this.adContainerDiv=
this.vjsControls.el().parentNode.appendChild(b.createElement("div"));e(this.adContainerDiv,"ima-ad-container");this.adContainerDiv.style.position="absolute";this.adContainerDiv.style.zIndex=1111;this.adContainerDiv.addEventListener("mouseenter",C,!1);this.adContainerDiv.addEventListener("mouseleave",D,!1);this.adContainerDiv.addEventListener("click",function(){this.adsActive||(!1===this.player.paused()?this.player.pause():this.player.play())}.bind(this),!1);n();this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainerDiv,
this.contentPlayer)}.bind(this),n=function(){this.controlsDiv=b.createElement("div");e(this.controlsDiv,"ima-controls-div");this.controlsDiv.style.width="100%";this.countdownDiv=b.createElement("div");e(this.countdownDiv,"ima-countdown-div");this.countdownDiv.innerHTML=this.settings.adLabel;this.countdownDiv.style.display=this.showCountdown?"block":"none";this.seekBarDiv=b.createElement("div");e(this.seekBarDiv,"ima-seek-bar-div");this.seekBarDiv.style.width="100%";this.progressDiv=b.createElement("div");
e(this.progressDiv,"ima-progress-div");this.playPauseDiv=b.createElement("div");e(this.playPauseDiv,"ima-play-pause-div");f(this.playPauseDiv,"ima-playing");this.playPauseDiv.addEventListener("click",q,!1);this.muteDiv=b.createElement("div");e(this.muteDiv,"ima-mute-div");f(this.muteDiv,"ima-non-muted");this.muteDiv.addEventListener("click",E,!1);this.sliderDiv=b.createElement("div");e(this.sliderDiv,"ima-slider-div");this.sliderDiv.addEventListener("mousedown",F,!1);this.sliderLevelDiv=b.createElement("div");
e(this.sliderLevelDiv,"ima-slider-level-div");this.fullscreenDiv=b.createElement("div");e(this.fullscreenDiv,"ima-fullscreen-div");f(this.fullscreenDiv,"ima-non-fullscreen");this.fullscreenDiv.addEventListener("click",G,!1);this.adContainerDiv.appendChild(this.controlsDiv);this.controlsDiv.appendChild(this.countdownDiv);this.controlsDiv.appendChild(this.seekBarDiv);this.controlsDiv.appendChild(this.playPauseDiv);this.controlsDiv.appendChild(this.muteDiv);this.controlsDiv.appendChild(this.sliderDiv);
this.controlsDiv.appendChild(this.fullscreenDiv);this.seekBarDiv.appendChild(this.progressDiv);this.sliderDiv.appendChild(this.sliderLevelDiv)}.bind(this);this.initializeAdDisplayContainer=function(){this.adDisplayContainerInitialized=!0;this.adDisplayContainer.initialize()}.bind(this);this.requestAds=function(){this.adDisplayContainerInitialized||this.adDisplayContainer.initialize();var a=new google.ima.AdsRequest;this.settings.adTagUrl?a.adTagUrl=this.settings.adTagUrl:a.adsResponse=this.settings.adsResponse;
this.settings.forceNonLinearFullSlot&&(a.forceNonLinearFullSlot=!0);a.linearAdSlotWidth=this.getPlayerWidth();a.linearAdSlotHeight=this.getPlayerHeight();a.nonLinearAdSlotWidth=this.settings.nonLinearWidth||this.getPlayerWidth();a.nonLinearAdSlotHeight=this.settings.nonLinearHeight||this.getPlayerHeight()/3;this.adsLoader.requestAds(a)}.bind(this);var L=function(a){this.adsManager=a.getAdsManager(this.contentPlayheadTracker,this.adsRenderingSettings);this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,
l);this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,H);this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested_);this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested_);this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,I);this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,J);this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,
K);this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,q);this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete_);this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete_);if(!this.autoPlayAdBreaks)try{var d=this.getPlayerWidth(),b=this.getPlayerHeight();this.adsManagerDimensions.width=d;this.adsManagerDimensions.height=b;this.adsManager.init(d,b,google.ima.ViewMode.NORMAL);this.adsManager.setVolume(this.player.muted()?0:this.player.volume())}catch(c){l(c)}this.player.trigger("adsready")}.bind(this);
this.start=function(){c.console.log("WARNING: player.ima.start is deprecated. Use player.ima.startFromReadyCallback instead.")};this.startFromReadyCallback=function(){if(this.autoPlayAdBreaks)try{this.adsManager.init(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume()),this.adsManager.start()}catch(a){l(a)}}.bind(this);var M=function(a){c.console.log("AdsLoader error: "+a.getError());this.adContainerDiv.style.display=
"none";this.adsManager&&this.adsManager.destroy();this.player.trigger({type:"adserror",data:{AdError:a.getError(),AdErrorEvent:a}})}.bind(this),l=function(a){var d=void 0!==a.getError?a.getError():a.stack;c.console.log("Ad error: "+d);this.vjsControls.show();this.adsManager.destroy();this.adContainerDiv.style.display="none";this.player.trigger({type:"adserror",data:{AdError:d,AdErrorEvent:a}})}.bind(this),H=function(a){this.adBreakReadyListener(a)}.bind(this);this.playAdBreak=function(){this.autoPlayAdBreaks||
this.adsManager.start()}.bind(this);this.onContentPauseRequested_=function(a){this.adPlaying=this.adsActive=!0;this.player.off("ended",this.localContentEndedListener);-1!=a.getAd().getAdPodInfo().getPodIndex()&&this.player.ads.startLinearAdMode();this.adContainerDiv.style.display="block";this.controlsDiv.style.display="application/javascript"===a.getAd().getContentType()&&!this.settings.showControlsForJSAds?"none":"block";this.vjsControls.hide();m();this.player.pause()}.bind(this);this.onContentResumeRequested_=
function(){this.adPlaying=this.adsActive=!1;this.player.on("ended",this.localContentEndedListener);if(null==this.currentAd||this.currentAd.isLinear())this.adContainerDiv.style.display="none";this.vjsControls.show();this.currentAd?!this.contentComplete&&-1!=this.currentAd.getAdPodInfo().getPodIndex()&&this.player.ads.endLinearAdMode():this.player.ads.endLinearAdMode();this.countdownDiv.innerHTML=""}.bind(this);var I=function(){this.allAdsCompleted=!0;if(!0==this.contentComplete)for(var a in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[a]()}.bind(this),
J=function(a){a.getAd().isLinear()||this.player.play()}.bind(this),K=function(a){this.currentAd=a.getAd();this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(N,250),g(this.adContainerDiv,"bumpable-ima-ad-container")):f(this.adContainerDiv,"bumpable-ima-ad-container")}.bind(this);this.onAdComplete_=function(){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)}.bind(this);var N=function(){var a=this.adsManager.getRemainingTime(),d=this.currentAd.getDuration(),b=d-a,b=0<b?b:0,c=!1,
e=0,f;this.currentAd.getAdPodInfo()&&(c=!0,f=this.currentAd.getAdPodInfo().getAdPosition(),e=this.currentAd.getAdPodInfo().getTotalAds());var h=Math.floor(a/60),a=Math.floor(a%60);2>a.toString().length&&(a="0"+a);var g=": ";c&&1<e&&(g=" ("+f+" of "+e+"): ");this.countdownDiv.innerHTML=this.settings.adLabel+g+h+":"+a;this.progressDiv.style.width=100*(b/d)+"%"}.bind(this);this.getPlayerWidth=function(){var a=this.player?this.player.width():0;this.player&&getComputedStyle(this.player.el())&&(a=parseInt(getComputedStyle(this.player.el()).width,
10));return a}.bind(this);this.getPlayerHeight=function(){var a=this.player?this.player.height():0;this.player&&getComputedStyle(this.player.el())&&(a=parseInt(getComputedStyle(this.player.el()).height,10));return a}.bind(this);var D=function(){this.controlsDiv.style.height="14px";this.playPauseDiv.style.display="none";this.muteDiv.style.display="none";this.sliderDiv.style.display="none";this.fullscreenDiv.style.display="none"}.bind(this),C=function(){this.controlsDiv.style.height="37px";this.playPauseDiv.style.display=
"block";this.muteDiv.style.display="block";this.sliderDiv.style.display="block";this.fullscreenDiv.style.display="block"}.bind(this),r=function(){f(this.playPauseDiv,"ima-paused");g(this.playPauseDiv,"ima-playing")}.bind(this),m=function(){f(this.playPauseDiv,"ima-playing");g(this.playPauseDiv,"ima-paused")}.bind(this),q=function(){this.adPlaying?(r(),this.adsManager.pause(),this.adPlaying=!1):(m(),this.adsManager.resume(),this.adPlaying=!0)}.bind(this),E=function(){this.adMuted?(f(this.muteDiv,"ima-non-muted"),
g(this.muteDiv,"ima-muted"),this.adsManager.setVolume(1),this.player.muted(!1),this.adMuted=!1,this.sliderLevelDiv.style.width=100*this.player.volume()+"%"):(f(this.muteDiv,"ima-muted"),g(this.muteDiv,"ima-non-muted"),this.adsManager.setVolume(0),this.player.muted(!0),this.adMuted=!0,this.sliderLevelDiv.style.width="0%")}.bind(this),F=function(){b.addEventListener("mouseup",s,!1);b.addEventListener("mousemove",t,!1)},t=function(a){u(a)},s=function(a){u(a);b.removeEventListener("mousemove",t);b.removeEventListener("mouseup",
s)},u=function(a){a=(a.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth;a=Math.min(Math.max(100*a,0),100);this.sliderLevelDiv.style.width=a+"%";this.player.volume(a/100);this.adsManager.setVolume(a/100);0==this.player.volume()?(f(this.muteDiv,"ima-muted"),g(this.muteDiv,"ima-non-muted"),this.player.muted(!0),this.adMuted=!0):(f(this.muteDiv,"ima-non-muted"),g(this.muteDiv,"ima-muted"),this.player.muted(!1),this.adMuted=!1)}.bind(this),G=function(){this.player.isFullscreen()?
this.player.exitFullscreen():this.player.requestFullscreen()}.bind(this),O=function(){this.player.isFullscreen()?(f(this.fullscreenDiv,"ima-fullscreen"),g(this.fullscreenDiv,"ima-non-fullscreen"),this.adsManager&&this.adsManager.resize(c.screen.width,c.screen.height,google.ima.ViewMode.FULLSCREEN)):(f(this.fullscreenDiv,"ima-non-fullscreen"),g(this.fullscreenDiv,"ima-fullscreen"),this.adsManager&&this.adsManager.resize(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL))}.bind(this),
P=function(){var a=this.player.muted()?0:this.player.volume();this.adsManager&&this.adsManager.setVolume(a);0==a?(this.adMuted=!0,f(this.muteDiv,"ima-muted"),g(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.adMuted=!1,f(this.muteDiv,"ima-non-muted"),g(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*a+"%")}.bind(this),v=function(){this.player.off("loadedmetadata",v);this.player.currentTime(0)}.bind(this),w=function(){this.player.off("loadedmetadata",w);this.player.currentTime(0);
this.player.play()}.bind(this),x=function(){this.adPlaying=this.adsActive=!1;this.player.on("ended",this.localContentEndedListener);this.currentAd&&this.currentAd.isLinear()&&(this.adContainerDiv.style.display="none");this.vjsControls.show();this.player.ads.endLinearAdMode();this.adTrackingTimer&&clearInterval(this.adTrackingTimer);this.adsManager&&(this.adsManager.destroy(),this.adsManager=null);this.adsLoader&&!this.contentComplete&&this.adsLoader.contentComplete();this.allAdsCompleted=this.contentComplete=
!1}.bind(this);this.addEventListener=function(a,d){this.adsManager&&this.adsManager.addEventListener(a,d)}.bind(this);this.getAdsManager=function(){return this.adsManager}.bind(this);this.setContent=function(a,d,b){c.console.log("WARNING: player.ima.setContent is deprecated. Use player.ima.setContentWithAdTag instead.");this.setContentWithAdTag(a,d,b)}.bind(this);this.setContentWithAdTag=function(a,d,b){x();this.settings.adTagUrl=d?d:this.settings.adTagUrl;y(a,b)}.bind(this);this.setContentWithAdsResponse=
function(a,b,c){x();this.settings.adsResponse=b?b:this.settings.adsResponse;y(a,c)}.bind(this);var y=function(a,b){this.player.currentSrc()&&(this.player.currentTime(0),this.player.pause());a&&this.player.src(a);if(b)this.player.on("loadedmetadata",w);else this.player.on("loadedmetadata",v)}.bind(this);this.addContentEndedListener=function(a){this.contentEndedListeners.push(a)}.bind(this);this.addContentAndAdsEndedListener=function(a){this.contentAndAdsEndedListeners.push(a)}.bind(this);this.setAdBreakReadyListener=
function(a){this.adBreakReadyListener=a}.bind(this);this.pauseAd=function(){this.adsActive&&this.adPlaying&&(r(),this.adsManager.pause(),this.adPlaying=!1)}.bind(this);this.resumeAd=function(){this.adsActive&&!this.adPlaying&&(m(),this.adsManager.resume(),this.adPlaying=!0)}.bind(this);var z=function(){this.updateTimeIntervalHandle=setInterval(Q,this.seekCheckInterval);this.seekCheckIntervalHandle=setInterval(R,this.seekCheckInterval);this.resizeCheckIntervalHandle=setInterval(S,this.resizeCheckInterval)}.bind(this),
Q=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.player.currentTime())}.bind(this),R=function(){var a=1E3*(this.player.currentTime()-this.contentPlayheadTracker.previousTime);this.contentPlayheadTracker.seeking=Math.abs(a)>this.seekCheckInterval+this.seekThreshold?!0:!1;this.contentPlayheadTracker.previousTime=this.player.currentTime()}.bind(this),S=function(){var a=this.getPlayerWidth(),b=this.getPlayerHeight();if(this.adsManager&&(a!=this.adsManagerDimensions.width||
b!=this.adsManagerDimensions.height))this.adsManagerDimensions.width=a,this.adsManagerDimensions.height=b,this.adsManager.resize(a,b,google.ima.ViewMode.NORMAL)}.bind(this);this.setShowCountdown=function(a){this.showCountdown=a;this.countdownDiv.style.display=this.showCountdown?"block":"none"}.bind(this);this.VERSION="0.2.0";this.adDisplayContainerInitialized=!1;this.adsRenderingSettings=null;this.allAdsCompleted=this.contentComplete=this.adMuted=this.adPlaying=this.adsActive=!1;this.seekCheckInterval=
1E3;this.resizeCheckInterval=250;this.seekThreshold=100;this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0};this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0};this.adsManagerDimensions={width:0,height:0};this.contentEndedListeners=[];this.contentAndAdsEndedListeners=[];this.adBreakReadyListener=void 0;this.localContentEndedListener=function(){this.adsLoader&&!this.contentComplete&&(this.adsLoader.contentComplete(),this.contentComplete=!0);
for(var a in this.contentEndedListeners)this.contentEndedListeners[a]();if(this.allAdsCompleted)for(a in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[a]();clearInterval(this.updateTimeIntervalHandle);clearInterval(this.seekCheckIntervalHandle);clearInterval(this.resizeCheckIntervalHandle);if(this.player.el())this.player.one("play",z)}.bind(this);this.playerDisposedListener=function(){this.contentEndedListeners;this.contentAndAdsEndedListeners=[];[];this.contentComplete=!0;this.player.off("ended",
this.localContentEndedListener);this.player.ads.adTimeoutTimeout&&clearTimeout(this.player.ads.adTimeoutTimeout);var a=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.adTrackingTimer,this.resizeCheckIntervalHandle],b;for(b in a){var c=a[b];c&&clearInterval(c)}this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)}.bind(this);this.settings=o({},B,j||{});if(this.settings.id){this.controlPrefix=this.settings.id+"_"||"";this.contentPlayer=b.getElementById(this.settings.id+
"_html5_api");this.showCountdown=!0;!1==this.settings.showCountdown&&(this.showCountdown=!1);this.autoPlayAdBreaks=!0;!1==this.settings.autoPlayAdBreaks&&(this.autoPlayAdBreaks=!1);h.one("play",z);h.on("ended",this.localContentEndedListener);h.on("dispose",this.playerDisposedListener);j=o({},{debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},j.contribAdsSettings||{});h.ads(j);this.adsRenderingSettings=new google.ima.AdsRenderingSettings;this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=
!0;if(this.settings.adsRenderingSettings)for(var A in this.settings.adsRenderingSettings)this.adsRenderingSettings[A]=this.settings.adsRenderingSettings[A];this.settings.locale&&google.ima.settings.setLocale(this.settings.locale);k();this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer);this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);!1==this.settings.vpaidAllowed&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED);
this.settings.vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.settings.vpaidMode);this.settings.locale&&this.adsLoader.getSettings().setLocale(this.settings.locale);this.settings.numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.settings.numRedirects);this.adsLoader.getSettings().setPlayerType("videojs-ima");this.adsLoader.getSettings().setPlayerVersion(this.VERSION);this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks);this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
L,!1);this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,M,!1);i||(i=this.startFromReadyCallback);h.on("contentplayback",this.onContentResumeRequested_);h.on("readyforpreroll",i);h.ready(function(){h.on("fullscreenchange",O);h.on("volumechange",P)})}else c.console.log("Error: must provide id of video.js div")};k.plugin("ima",function(b,c){this.ima=new n(this,b,c)})});
