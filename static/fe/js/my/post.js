(function(a,b){a.isLoading=!1;a.maxRenderedVidIdx=0;a.videoList=[];a.currentId=!1;a.isContinue=!0;a.playerList=[];a.currentIndex=0;a.activeVideo=null;a.timeTracking=10;a.videoQuality=0;a.eventScroll="scroll";a.volumeDefault=90;a.hasVideoIntro=!1;a.firstVideo=!0;a.lastScrollTop=-100;a.minRenderedVidIdx=0;a.init=function(){b("html, body").animate({scrollTop:80},1E3);Main.isMobile.any()&&b("#footer").hide();var c=b("#view-page .container"),d=b("#view-page .container .sidebar");Main.floatingSidebar(c,
d);a.addVideo();Main.playWithVideoJS()?VideoManager.autoPlayVideo():a.autoPlayVideo();var e=b("#view-page .container .main-content .post .show-notification");a.firstVideo&&!FeelStatic.getCookie("feel_hide_firstVideo")&&(e.show(),a.firstVideo=!1);e.find(".btn-close").click(function(a){a.preventDefault();FeelStatic.setCookie("feel_hide_firstVideo","true",365);e.hide()});b(window).resize(function(){var a=b(".video-js"),c=a.parent();a.width(c.width()).height(c.height())});var g;b(window).bind("scroll",
function(){a.isScrolling=true;g&&clearTimeout(g);g=setTimeout(function(){a.isScrolling=false},300)});b(window).unload(function(){b(window).scrollTop(0)})};a.addVideo=function(){var c=-100;b(window).bind("scroll",function(){if(!(a.isLoading||10>Math.abs(b(window).scrollTop()-c)&&Math.max(a.currentIndex,0)<a.maxRenderedVidIdx-1)){c=b(window).scrollTop();var d=b(document).height()-b("#footer").height();if(b(this).scrollTop()+b(this).height()+200>d||Math.max(a.currentIndex,0)>=a.maxRenderedVidIdx-1||
Math.max(a.currentIndex,0)<=a.minRenderedVidIdx)a.currentIndex>=a.videoList.length-2&&!0==a.isContinue&&a.getVideo(function(){a.renderPosts(a.videoList)}),a.renderPosts(a.videoList)}})};a.renderPosts=function(c){var d,e=1,g=2;Main.isMobile.any()||(e=5,g=10);var l=e+g+1;a.renderingPost||(a.renderingPost=!0,(d=function(){if(a.isScrolling)setTimeout(d,100);else{for(var k=b("#view-page .container .main-content .post"),o=b("#view-page .container .main-content");a.minRenderedVidIdx>a.currentIndex-e&&a.minRenderedVidIdx>
0;){var h=--a.minRenderedVidIdx,i=b("#view-page .container .main-content .post").last(),i=k.length<l?b("#post-sample").clone().css("display","block").addClass("post").attr("id",""):i;i.attr("video-index",h);var j=a.renderPostDetails(i,c[h],h),n="",m=c[h].warning_type,n=m?FeelStatic.templateUrl+"Public/images/img-warning-740x416.jpg":FeelStatic.baseURL+c[h].picture;i.prependTo(o);if(i[0]==k.last()[0]){a.maxRenderedVidIdx--;b(window).scrollTop(b(window).scrollTop()+i.outerHeight(true))}if(Main.playWithVideoJS()){i[0].player.dispose();
i[0].player=VideoManager.initPlayer({container:j,url:c[h].hls,picture:n,warningType:c[h].warning_type,seo_id:c[h].seo_id})}else a.playerVideo(postId,j,sourceList,n,urlLogo,false,m)}for(;a.maxRenderedVidIdx<a.videoList.length&&a.maxRenderedVidIdx<=a.currentIndex+g;){h=a.maxRenderedVidIdx++;j=b("#view-page .container .main-content .post").first();i=k.length<l?b("#post-sample").clone().css("display","block").addClass("post").attr("id",""):j;i.attr("video-index",h);if(i[0]==j[0]){a.minRenderedVidIdx++;
b(window).scrollTop(b(window).scrollTop()-i.outerHeight(true))}j=a.renderPostDetails(i,c[h],h);n=c[h].warning_type!=0?FeelStatic.templateUrl+"Public/images/img-warning-740x416.jpg":FeelStatic.baseURL+c[h].picture;i.appendTo(o);a.showVoucher();if(Main.playWithVideoJS()){i[0].player&&i[0].player.dispose();i[0].player=VideoManager.initPlayer({container:j,url:c[h].hls,picture:n,warningType:c[h].warning_type,seo_id:c[h].seo_id})}else a.playerVideo(postId,j,sourceList,n,urlLogo,false,m);b(window).scroll()}a.renderingPost=
false}})())};a.increaseViewedNumber=function(){var a=FeelStatic.getCookie("feel_viewed_videos");a||(a=0);a=parseInt(a)+1;FeelStatic.setCookie("feel_viewed_videos",a,1)};a.getNumberOfViewedVideos=function(){var a=FeelStatic.getCookie("feel_viewed_videos");return!a?0:parseInt(a)};a.getVideo=function(c){var d=b("#loading-container .loading");a.isLoading=!0;d.fadeIn(500);b.ajax({url:FeelStatic.baseURL+"post/next/",method:"POST",dataType:"json",data:{id:a.currentId},statusCode:{403:Main.showCaptchaInput}}).done(function(b){b=
b.newPosts;0==b.length&&(a.isContinue=!1);for(var d=0;d<b.length;d++)a.videoList.push(b[d]);a.isLoading=!1;c&&c()})};a.checkQualityVideo=function(){if(1!=jwp.sources.length){var c=jwp.getHeight();2==jwp.sources.length?a.videoQuality=750<=Main.speedNetwork&&240<c?1:2:3==jwp.sources.length&&(a.videoQuality=1500<=Main.speedNetwork&&480<c?0:750<=Main.speedNetwork&&240<c?1:2)}};a.sloganScroll=function(a){a.addClass("active")};a.pushState=function(c){var b;b=function(){a.isScrolling?a.PushStateTimer=setTimeout(b,
1E3):(FeelStatic.changeUrlWithoutReload(c,c.title,FeelStatic.baseURL+"post/"+c.seo_id),document.title=c.title+" | Th\u1eadt vi di\u1ec7u",ga("send",{hitType:"pageview",page:location.pathname}))};a.PushStateTimer&&clearTimeout(a.PushStateTimer);b()};a.inVisibleArea=function(a){var d=b(a).children().first(),a=d.offset().top+d.height()/3,d=d.offset().top+2*d.height()/3,a=a>=b(window).scrollTop(),d=d<=b(window).scrollTop()+b(window).height();return a&&d};a.nextVideo=function(){if(!(a.currentIndex>=a.videoList.length)){var c=
b(a.activeVideo).next();b("html, body").animate({scrollTop:c.offset().top-50},300)}};a.selectReportVideoItem=function(a,d){var a=b(a),e=b("#modal-form").find(".report-reason");"other"==d?e.val("").show():(e.hide(),e.val(a.find("span").html()))};a.reportVideoId=!1;a.showReportContainer=function(c){c=b(c);a.reportVideoId=c.attr("data-text");var c=b("#view-page-report-video"),d=[{text:"G\u1eedi report",handler:a.reportVideoByClick}];Main.showModalForm("",c.html(),d)};a.reportVideoByClick=function(){var c=
b("#modal-form").find(".report-reason");""==c.val()?alert("Vui l\u00f2ng cho thatvidieu.com bi\u1ebft l\u00fd do nh\u00e9"):(a.reportVideo(a.reportVideoId,c.val()),Main.hideModalForm(),a.reportVideoId=!1)};a.btnShare=function(a){a=b(a);a.parent().find(".social").toggleClass("active")};a.shareSocial=function(a,d){var e=("facebook"==d?"https://www.facebook.com/sharer.php?u=":"google"==d?"https://plus.google.com/share?url=":"https://twitter.com/share?url=")+window.location.protocol+FeelStatic.baseURL+
b(a).attr("data-short-link"),g=b(a).attr("data-title");window.open(e,g,"height=450, width=550, top="+(b(window).height()/2-275)+", left="+(b(window).width()/2-225)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0")};a.copyToClipboard=function(a){var a=window.location.protocol+FeelStatic.baseURL+b(a).attr("data-short-link"),d=b("<input>");b("body").append(d);d.val(a).select();document.execCommand("copy");d.remove();Main.notification("\u0110\u00e3 sao ch\u00e9p li\u00ean k\u1ebft r\u00fat g\u1ecdn:<br><b>"+
a+"</b>")};a.viewMoreInfo=function(a){var a=b(a),d=a.parent(),e=d.parent().find(".readMore-container");d.hide();e.removeClass("hide");if("true"==a.attr("data-load-comment")){var d=a.attr("data-post_id"),d=b.ajax({url:FeelStatic.baseURL+"post/getComment",method:"GET",dataType:"json",data:{post:d,page:0}}),a=a.parent().parent().find(".readMore-container"),g=a.find(".cmt-container"),l=a.find(".cmt-default .no-cmt"),k=a.find(".cmt-default .cmt");d.done(function(a){if(0==a.length)l.appendTo(g);else for(var c=
0;c<a.length;c++){var b=k.clone(),d=b.find(".sup-cmt");d.find(".avt").css("background-image","url("+a[c].user.avatar+")");var e=d.find(".cmt-content");e.find(".username").text(a[c].user.name);e.find("span").html(a[c].content);d.find(".like").find(".time").text(a[c].fantastic_time);b.appendTo(g)}})}};a.focusCmt=function(a,d){if(Main.isLoggedIn()){var a=b(a),e=a.parent().find(".btn-submit");d?e.show():setTimeout(function(){e.hide()},100)}else Main.notification("B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp \u0111\u1ec3 th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y")};
a.addComment=function(a){if(Main.isLoggedIn()){var a=b(a),d=a.parent().find(".txt-cmt");if(5>d.val().length)Main.notification("Comment \u00edt nh\u1ea5t 5 k\u00fd t\u1ef1 nh\u00e9");else{var e=a.parent(),g=e.find(".cmt").clone(),l=e.parent().find(".cmt-container");l.find(".no-cmt").hide();var k=Main.getProfile();g.find(".username").html(k.username);g.find(".avt").css("background-image","url("+k.avatar+")");g.find(".cmt-content > span").html(d.val());g.find(".time").html("\u0110ang g\u1eedi");g.prependTo(l).show();
e=b.ajax({url:FeelStatic.baseURL+"post/comment",method:"POST",dataType:"json",data:{post:e.attr("data-text"),content:d.val()},statusCode:{403:Main.showCaptchaInput}});a.prop("disabled",!0);e.done(function(b){b.error_message?g.find(".time").html("C\u00f3 l\u1ed7i x\u1ea3y ra vui l\u00f2ng th\u1eed l\u1ea1i sau"):g.find(".time").html("V\u1eeba xong");g.find(".cmt-content > span").html(b.content);a.prop("disabled",!1);d.val("")})}}else Main.notification("B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp \u0111\u1ec3 th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y")};
a.likeVideo=function(a,d){if(!1===Main.isLoggedIn())Main.notification("B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp \u0111\u1ec3 th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y.");else{var a=b(a),e=a.parent(),g=e.attr("data-text"),l=e.find("a.btn-like"),k=e.find("a.btn-dislike");a.hasClass("btn-like")?k.removeClass("active"):l.removeClass("active");a.toggleClass("active");b.ajax({url:FeelStatic.baseURL+"post/like",method:"POST",dataType:"json",data:{post_id:g,like:d},statusCode:{403:Main.showCaptchaInput}}).done(function(b){b.error_message?
(Main.notification("B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp <br> \u0111\u1ec3 th\u1ef1c hi\u1ec7n thao t\u00e1c n\u00e0y."),a.toggleClass("active")):(k.find(".number").text(b.format_dislikes),l.find(".number").text(b.format_likes))})}};a.checkLike=function(a){b.ajax({url:FeelStatic.baseURL+"post/checkLike?id="+a,method:"GET",dataType:"json"}).done(function(d){!0===d.like?b("#like-"+a).find(".btn-like").addClass("active"):!0==d.dislike&&b("#like-"+a).find(".btn-dislike").addClass("active")})};a.playerVideo=
function(c,d,e,g,l,k,o){b("#"+d).html("");var h=b("#"+d).width(),i="",i="16:9"==Main.aspectRatio?0.5625:0.75;b("#"+d).height(h*i);var j=b("#view-page .container .slogan"),n=-100;b(window).bind("scroll",function(){if(j.hasClass("active")&&10<Math.abs(b(window).scrollTop()-n)){n=b(window).scrollTop();var a=b(document).height()-b("#footer").height();b(this).scrollTop()+b(this).height()+300>a&&j.removeClass("active")}});for(var m=[],h=0;h<e.length;h++)i={},i.file=FeelStatic.baseURL+e[h].url,i.label=e[h].size+
"p",m.push(i);e=[{file:FeelStatic.baseURL+"resources/video-intro-HD.mp4",label:"720p"},{file:FeelStatic.baseURL+"resources/video-intro-SD.mp4",label:"480p"}];h=[];h=0>document.referrer.indexOf(FeelStatic.baseURL);i=""!=FeelStatic.getCookie("feel_viewed_intro");(h||Main.getPartner())&&!a.hasVideoIntro&&!i?(h=[{image:g,sources:e},{image:g,sources:m}],a.hasVideoIntro=!0,FeelStatic.setCookie("feel_viewed_intro","true",Main.getPartner()?0.15:1)):h=[{image:g,sources:m}];var f=jwplayer(d).setup({playlist:h,
width:"100%",aspectratio:Main.aspectRatio,autostart:k,skin:{name:"glow",active:"#009dff"},logo:{file:l,margin:"15"}});f.postId=c;f.trackId=!1;f.isTracking=!1;f.lastTrackedPosition=0;f.checkedQuality=!1;f.warningType=o;f.on("ready",function(){var c=b(this.getContainer()).find("video");c.bind("contextmenu",function(a){a.stopPropagation();a.preventDefault()});c.attr("playsinline","");var d=b(this.getContainer());d.mouseover(function(){d.removeClass("jw-flag-user-inactive")});d.mouseout(function(){d.addClass("jw-flag-user-inactive")});
d.focus(function(){d.css("outline","none")});b(this.getContainer()).find(".jw-controls").find(".jw-display-icon-container.jw-background-color").css({"background-color":"rgba(0, 0, 0, 0.6)","border-radius":"50%"});c=b(this.getContainer()).find(".jw-controlbar");c.css({background:"-webkit-linear-gradient(transparent, rgba(0, 0, 0, 1))",background:"linear-gradient(transparent, rgba(0, 0, 0, 1))"});c.find(".jw-icon-prev, .jw-icon-playlist, .jw-icon-next").css("display","none");a.playerList.push(f)});
f.sources=m;f.hasAcceptedWarning=!1;f.on("play",function(){if(FeelStatic.getCookie("quality"))f.setCurrentQuality(parseInt(FeelStatic.getCookie("quality"))-(3-m.length));else if(!f.checkedQuality){a.checkQualityVideo(f);f.setCurrentQuality(a.videoQuality-(3-m.length));f.checkedQuality=true}j.removeClass("active");var c=b(this.getContainer()).find(".jw-icon-hd");switch(f.getCurrentQuality()+(3-f.sources.length)){case 0:c.css("color","#e80800");break;case 1:c.css("color","#ff8f8b");break;default:c.css("color",
"#ffffff")}if(FeelStatic.getCookie("volume"))if(FeelStatic.getCookie("volume")>0){f.setMute(false);f.setVolume(FeelStatic.getCookie("volume"))}else f.setMute(true);else f.setVolume(a.volumeDefault);f.hasAcceptedWarning||a.checkWarning(f)});f.on("pause",function(){a.trackingVideo(this);f.hasAcceptedWarning&&a.hasVideoIntro&&a.sloganScroll(j)});f.on("time",function(){f.getDuration()-f.getPosition()<=10&&a.hasVideoIntro&&a.sloganScroll(j);f.getPosition()-f.position>a.timeTracking&&(f.trackId===false&&
f.isTracking===false)&&a.trackingVideo(this)});f.on("seek",function(a){f.position=a.offset});f.on("complete",function(){a.trackingVideo(this)});f.on("fullscreen",function(){});f.on("volume",function(){f.setMute(false);FeelStatic.setCookie("volume",f.getVolume(),1)});f.on("mute",function(){FeelStatic.setCookie("volume",0,1)});f.on("levelsChanged",function(a){FeelStatic.setCookie("quality",a.currentQuality+(3-f.sources.length),0);a.currentQuality+(3-f.sources.length)>1&&/(android)/i.test(navigator.userAgent)&&
b(this.getContainer()).addClass("hide-buffering-spinner")});f.position=0};a.autoPlayVideo=function(){b(window).bind("scroll",function(){if(-1==a.currentIndex)b("#view-page .container .main-content .post").each(function(b,c){if(b<a.playerList.length&&a.checkPlayVideo(c))return(!Main.isMobile.iOS()||Main.isNativeApp())&&a.playerList[b].play(),a.currentIndex=b,a.activeVideo=c,!1});else{var c=b(window).scrollTop(),e=a.activeVideo,g=a.currentIndex;if(!(20>Math.abs(c-a.lastScrollTop))){for(;e&&g<a.playerList.length;){if(a.checkPlayVideo(e)){if(a.currentIndex!=
g&&!a.playerList[a.currentIndex].getFullscreen()&&!a.checkPlayVideo(a.activeVideo)){a.trackingVideo(a.playerList[a.currentIndex]);a.playerList[a.currentIndex].position=a.playerList[a.currentIndex].getPosition();a.playerList[a.currentIndex].checkedQuality=!1;a.playerList[a.currentIndex].stop();if(!Main.isMobile.iOS()||Main.isNativeApp())0<a.playerList[g].position?a.playerList[g].seek(a.playerList[g].position):a.playerList[g].play();a.pushState(a.videoList[g]);a.currentIndex=g;a.activeVideo=e}return}if(c<
a.lastScrollTop){do e=e.previousSibling;while(e&&("DIV"!=e.tagName||0>(" "+e.className+" ").indexOf(" post ")));g--}else{do e=e.nextSibling;while(e&&("DIV"!=e.tagName||0>(" "+e.className+" ").indexOf(" post ")));g++}}a.lastScrollTop=c}}});var c=0;b(window).bind("touchstart",function(){-1==a.currentIndex&&b("#view-page .container .main-content .post").each(function(b,c){if(b<a.playerList.length&&a.checkPlayVideo(c))return(!Main.isMobile.iOS()||Main.isNativeApp())&&a.playerList[b].play(),a.currentIndex=
b,a.activeVideo=c,!1});for(var d=a.playerList.length,e=c;e<d;e++)if("idle"==a.playerList[e].getState()&&(!Main.isMobile.iOS()||Main.isNativeApp()))a.playerList[e].play(),e!=a.currentIndex&&a.playerList[e].stop();c=d})};a.trackingVideo=function(c){var d=c.getPosition(),e=d-c.position,g="complete"==c.getState()?1:0;if(!(5>d-c.lastTrackedPosition)||g)c.isTracking=!0,c.lastTrackedPosition=d,e>a.timeTracking?b.ajax({url:FeelStatic.baseURL+"post/track",method:"POST",data:{post_id:c.postId,duration:e,is_completed:g,
begin:c.position,end:c.getPosition(),trackId:c.trackId},dataType:"json"}).done(function(a){c.isTracking=!1;0!=a.id&&(c.trackId=a.id)}):c.isTracking=!1};a.checkWarning=function(a){if(0==a.warningType)a.hasAcceptedWarning=!0;else{a.pause();a.controls(!1);var d=b(a.getContainer()).parent().find(".warning-container"),e=b(a.getContainer()).find("video");d.show();e.css("-webkit-filter","blur(10px)");e.css("filter","blur(10px)");1==a.warningType&&d.find(".warning").text("Video c\u00f3 ch\u1ee9a n\u1ed9i dung nh\u1ea1y c\u1ea3m");
2==a.warningType&&d.find(".warning").text("Video c\u00f3 ch\u1ee9a n\u1ed9i dung g\u00e2y s\u1ee3 h\u00e3i");d.find(".btn-continue").click(function(b){b.preventDefault();a.play();a.controls(!0);d.hide();e.css("-webkit-filter","blur(0)");e.css("filter","blur(0)");a.hasAcceptedWarning=!0})}}})(window.ViewPage=window.ViewPage||{},jQuery);
